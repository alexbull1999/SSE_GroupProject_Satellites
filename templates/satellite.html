{% extends "layout.html" %}

{% block content %}
<main class="p-6">
    <section class="max-w-4xl mx-auto bg-gray-800 rounded-lg p-6 shadow-lg flex items-center space-x-6">
        <!-- Satellite Details -->
        <div class="flex-1">
            <h2 class="text-3xl font-bold text-indigo-400 mb-4">{{ satellite.name }}</h2>
            <div class="space-y-4">
                <div>
                    <span class="font-semibold text-gray-300">NORAD ID:</span>
                    <span class="text-white">{{ satellite.id }}</span>
                </div>
                <div>
                    <span class="font-semibold text-gray-300">Current Latitude:</span>
                    <span class="text-white">{{ satellite.lat }}</span>
                </div>
                <div>
                    <span class="font-semibold text-gray-300">Current Longitude:</span>
                    <span class="text-white">{{ satellite.long }}</span>
                </div>
                <div>
                    <span class="font-semibold text-gray-300">Current Location:</span>
                    <span class="text-white">{{ satellite.location }}</span>
                </div>
                <div>
                    <span class="font-semibold text-gray-300">Elevation:</span>
                    <span class="text-white">{{ satellite.elevation }}km</span>
                </div>
                <div>
                    <span class="font-semibold text-gray-300">Ground Speed:</span>
                    <span class="text-white">{{ satellite.ground_speed }}km/s</span>
                </div>
            </div>
        </div>

        <!-- Satellite Image -->
        <div>
            <img
                src="{{ satellite.image_url if satellite.image_url else 'https://wmo.int/sites/default/files/2023-03/AdobeStock_580430822.jpeg' }}"
                alt="Satellite Image"
                class="w-80 h-80 rounded-full border-4 border-white object-cover shadow-lg"
            />
        </div>
    </section>

<div id="map" style="height: 500px;"></div>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

<script>
    // Satellite data from Flask
    const satelliteName = "{{ satellite.name }}";
    const currentLatitudeDMS = "{{ satellite.lat }}";
    const currentLongitudeDMS = "{{ satellite.long }}";
    const observerLatitude = {{ observer_lat }};
    const observerLongitude = {{ observer_lng }};
    const nextPassUTC = {{ next_pass | default('null', true) }}; //Convert UTC time

    //Helper function to convert DMS to decimal
    function dmsToDecimal(dms) {
        const [degrees, minutes, seconds] = dms.split(":").map(parseFloat);
        const decimal = Math.abs(degrees) + (minutes/60) + (seconds / 3600);
        return degrees < 0 ? -decimal : decimal;
    }

    //convert DMS to decimal for satellite positions
    const currentLatitude = dmsToDecimal(currentLatitudeDMS);
    const currentLongitude = dmsToDecimal(currentLongitudeDMS);

    //Initialize the map
    const map = L.map('map').setView([currentLatitude, currentLongitude], 3);

    //Add a base layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
    }).addTo(map);

    // Add marker for satellite's current position
    L.marker([currentLatitude, currentLongitude])
        .addTo(map)
        .bindPopup(`<b>${satelliteName}</b><br>Lat: ${currentLatitude}<br>Lon: ${currentLongitude}`)
        .openPopup();

    //Add marker for observer's location
    L.marker([observerLatitude, observerLongitude])
        .addTo(map)
        .bindPopup(`<b>Your Location</b><br>Lat: ${observerLatitude}<br><br>Lon: ${observerLongitude}`);

    // Add callout for next visible pass
    if (nextPassUTC) {
        const nextPassDate = new Date(nextPassUTC * 1000); //Convert UTC timestamp to JS data
        L.marker([observerLatitude, observerLongitude])
            .addTo(map)
            .bindPopup(`<b>Next Visible Pass:</b><br>${nextPassDate.toLocaleString()}`)
            .openPopup();
    }
</script>

</main>
{% endblock %}





    <!---
<body>
<ul>
    <li>Name: {{ satellite["name"] }}</li>
    <li>NORAD ID: {{ satellite["id"] }}</li>
    <li>Latitude: {{ satellite["lat"] }}</li>
    <li>Longitude: {{ satellite["long"] }}</li>
    <li>Location: {{ satellite["location"] }}</li>
    <li>Elevation: {{ satellite["elevation"]}}km above sea level!</li>
    <li>Speed: {{ satellite["ground_speed"]}}km/s</li>
</ul>
</body>

    --->
